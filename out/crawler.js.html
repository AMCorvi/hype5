<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: crawler.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: crawler.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var casper = require("casper").create();
var utils = require("utils");

var tracks = [];

/**
 * IIFE sets variable only hypeFilter varibale only if such option was provided
 *
 * @returns {object} map of options specifying search type wanted
 */
//
var opt = (function() {
  var options = {};
  casper.cli.has("hypeType")
    ? (options.type = casper.cli.get("hypeType"))
    : null;
  casper.cli.has("hypeFilter")
    ? (options.filter = casper.cli.get("hypeFilter"))
    : null;
  return options;
})();


// TODO: Document
function getTrackInfo(tracks) {
  tracks;
  var element = document.getElementsByClassName("section-track");
  var cool = Array.prototype.map.call(element, function(element) {
    var artist = element.querySelector(".artist").text;
    var trackName = element.querySelector(".track").text;
    var postLink = element.querySelector(".readpost").getAttribute("href");
    var descFunc = function() {
      var descUnfiltered = element.querySelector(".post_info").textContent;
      // var regex = /“(?:[^\\"]+|\\.)*”/m ;
      // var result = descUnfiltered.match(regex);
      var end = descUnfiltered.indexOf("”") - 1;
      var start = descUnfiltered.indexOf("“") + 1;
      var result = descUnfiltered.substr(start, end - start);

      return result;
    };
    var desc = descFunc();
    var color = element.querySelector("a.thumb").style.cssText;

    var blogName = element.querySelector(".blog-fav-off").text;

    return {
      artist: artist,
      link: postLink,
      descrip: desc,
      thumbnail: color,
      song: trackName,
      blogName: blogName
    };
  });
  return tracks.concat(cool);
}

/**
 * Scan Hype Machine
 *
 * @param {string} type class of track info request [latest track or most popular tracks]
 * @param {array} filter filter for specifed class of tracks [none, remixes, noremixes]
 * @returns {array} An array of tracks information
 */
function scanHype(type, filter) {
  // set 'type' variable to popular as default if valid value is not provided
  type = type || "popular";

  // check variable and set correct url
  var url = !filter
    ? "http://hypem.com/"+type+"/"+filter
    : "http://hypem.com/"+type;

    /**
     * Start phantomjs instance that crawls url scraping data as instructed by callback function
     *
     * @returns {array} An array of track info from endpoint specified
     */
  casper.start(url, function() {
    this.waitForSelector(".post_info", function() {
      var info = this.evaluate(getTrackInfo, []);
      return (tracks = info);
    });
  });

  casper.then(function() {
    // eslint-disable-next-line no-console
    console.log(JSON.stringify(tracks, null, 2));
  });

  casper.run();
}

if (opt.filter) {
  utils.dump("type and filter");
  scanHype(opt.type, opt.filter);
} else {
  utils.dump(" type only");
  scanHype(opt.type);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#casperjsFunction">casperjsFunction</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#opt">opt</a></li><li><a href="global.html#scanHype">scanHype</a></li><li><a href="global.html#validate">validate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Nov 14 2017 16:12:54 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
